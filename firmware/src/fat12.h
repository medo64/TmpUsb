#ifndef FAT12_H
#define	FAT12_H

#include "fileio_config.h"
#include "driver/fileio/internal_flash.h"


#define MEDIA_PARTITION_SIZE    DRV_FILEIO_INTERNAL_FLASH_PARTITION_SIZE
#define MEDIA_SECTOR_SIZE       FILEIO_CONFIG_MEDIA_SECTOR_SIZE
#define MEDIA_RESERVED_SECTORS  DRV_FILEIO_INTERNAL_FLASH_NUM_RESERVED_SECTORS
#define MEDIA_ROOT_ENTRIES      DRV_FILEIO_CONFIG_INTERNAL_FLASH_MAX_NUM_FILES_IN_ROOT
#define MEDIA_FAT_SECTORS       DRV_FILEIO_INTERNAL_FLASH_NUM_FAT_SECTORS


#define FAT12_MBR {                                                                                  \
    /* Code Area */                                                                                  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,                                      \
                                                                                                     \
    /* IBM 9 byte/entry x 4 entries primary partition table */                                       \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00,                                                              \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,              \
                                                                                                     \
    0x00, 0x00,                                                                                      \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,                                                  \
                                                                                                     \
    /* Disk signature */                                                                             \
    0xF5, 0x8B, 0x16, 0xEA,                                                                          \
                                                                                                     \
    0x00, 0x00,                                                                                      \
                                                                                                     \
    /* Partition Entry 1 */                                                                          \
    0x00,                    /* Status - 0x80 (bootable), 0x00 (not bootable), other (error) */      \
    0x01, 0x01, 0x00,        /* Cylinder-head-sector address of first sector in partition */         \
    0x01,                    /* Partition type - 0x01 = FAT12 up to 2MB */                           \
    0x07, 0xFF, 0xE6,        /* Cylinder-head-sector address of last sector in partition */          \
    0x01, 0x00, 0x00, 0x00,  /* Logical Block Address (LBA) of first sector in partition */          \
    /* Partition Entry 1 - Length in sectors */                                                      \
    (uint8_t)MEDIA_PARTITION_SIZE,                                                                         \
    (uint8_t)(MEDIA_PARTITION_SIZE >> 8),                                                                  \
    (uint8_t)(MEDIA_PARTITION_SIZE >> 16),                                                                 \
    (uint8_t)(MEDIA_PARTITION_SIZE >> 24),                                                                 \
                                                                                                     \
    /* Partition Entry 2 */                                                                          \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
                                                                                                     \
    /* Partition Entry 3 */                                                                          \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
                                                                                                     \
    /* Partition Entry 4 */                                                                          \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
                                                                                                     \
    /* MBR signature */                                                                              \
    0x55, 0xAA                                                                                       \
}


#define FAT12_BOOT_SERIAL  0x4D, 0x65, 0x64, 0x6F

#define FAT12_BOOT {                                                                                 \
    0xEB, 0x3C, 0x90,  /* Jump instruction */                                                        \
    'M', 'S', 'D', 'O', 'S', '5', '.', '0',  /* OEM Name "MSDOS5.0" */                               \
    (MEDIA_SECTOR_SIZE&0xFF), (MEDIA_SECTOR_SIZE>>8), /* Bytes per sector (MEDIA_SECTOR_SIZE) */     \
    0x01,  /* Sectors per cluster */                                                                 \
    MEDIA_RESERVED_SECTORS, 0x00, /* Reserved sector count */                                              \
    0x01, /* number of FATs */                                                                       \
    MEDIA_ROOT_ENTRIES, 0x00, /* Max number of root directory entries */                             \
    0x00, 0x00,  /* total sectors (0x0000 means: use the 4 byte field at offset 0x20 instead) */     \
    0xF8,  /* Media Descriptor */                                                                    \
    MEDIA_FAT_SECTORS, 0x00,  /* Sectors per FAT */                                                  \
    0x3F, 0x00,  /* Sectors per track */                                                             \
    0xFF, 0x00,  /* Number of heads */                                                               \
    0x01, 0x00, 0x00, 0x00,  /* Hidden sectors */                                                    \
    /* Total sectors (when WORD value at offset 20 is 0x0000) */                                     \
    (uint8_t)MEDIA_PARTITION_SIZE,                                                                            \
    (uint8_t)(MEDIA_PARTITION_SIZE >> 8),                                                                     \
    (uint8_t)(MEDIA_PARTITION_SIZE >> 16),                                                                    \
    (uint8_t)(MEDIA_PARTITION_SIZE >> 24),                                                                    \
                                                                                                     \
    0x00,  /* Physical drive number */                                                               \
    0x00,  /* Reserved("current head") */                                                            \
    0x29,  /* Signature */                                                                           \
    FAT12_BOOT_SERIAL, /* ID(serial number) */                                                       \
    'N', 'O', ' ', 'N', 'A', 'M', 'E', ' ', ' ', ' ', ' ',  /* Volume Label (11 bytes) */            \
    'F', 'A', 'T', '1', '2', ' ', ' ', ' ',  /* FAT system "FAT12" */                                \
                                                                                                     \
    /* Operating system boot code */                                                                 \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \
                                                                                                     \
    /* End of sector (0x55AA) */                                                                     \
    0x55, 0xAA                                                                                       \
}


#define FAT12_FAT {                                                                                  \
    0xF8,0x0F,  /* Copy of the media descriptor 0xFF8 */                                             \
    0x00,                                                                                            \
}

#define FAT12_ROOT_DEFAULT_LABEL  'N','o','t',' ','A','r','m','e','d',' ',' '

#define FAT12_ROOT {                                                                                 \
    /* First entry */                                                                                \
    FAT12_ROOT_DEFAULT_LABEL,  /* Drive Name (11 chars, padded with spaces) */                       \
    0x08,  /* specify this entry as a volume label */                                                \
    0x00,  /* Reserved */                                                                            \
    0x00, 0x00, 0x00, 0x00, 0x00,  /* Create time */                                                 \
    0x00, 0x00,                    /* Last Access */                                                 \
    0x00, 0x00,                    /* EA-index */                                                    \
    0x00, 0x00, 0x00, 0x00,        /* Last modified time */                                          \
    0x00, 0x00,                    /* First FAT cluster */                                           \
    0x00, 0x00, 0x00, 0x00,        /* File Size (number of bytes) */                                 \
                                                                                                     \
    /* No next entry */                                                                              \
    0x00                                                                                             \
}


#endif



#if ((DRV_FILEIO_INTERNAL_FLASH_TOTAL_DISK_SIZE % 2) != 0)
    #error Drive has to have an even number of sectors.
#endif
